---
title: "Mapping All Fifty U.S. States"
author: "Vignette Author"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Mapping All Fifty U.S. States}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

This package contains the data file `fifty_states` which includes the shape
data to map the fifty U.S. states and Washington DC in `ggplot2`. Alaska 
and Hawaii are transformed and shifted to appear below the contiential states. 

```{r example}
library(ggplot2)
library(fiftystater)
data(fifty_states) # optional as lazy data is enabled

crimes <- data.frame(state = tolower(rownames(USArrests)), USArrests)

ggplot(crimes, aes(map_id = state)) +
  geom_map(aes(fill = Murder), map = fifty_states) +
  expand_limits(x = fifty_states$long, y = fifty_states$lat) +
  coord_map()

library(colorplaner)
ggplot(crimes, aes(map_id = state)) +
  geom_map(aes(fill = Murder, fill2 = UrbanPop), map = fifty_states) +
  scale_fill_colorplane() +
  expand_limits(x = fifty_states$long, y = fifty_states$lat) +
  coord_map()

```


The map data included in this package was generated with the code below. This
code was inspired by an answer on Stack Overflow by Barry Rowlingson:
[http://stackoverflow.com/a/13767984](http://stackoverflow.com/a/13767984). 

```{r makemap, message=FALSE}
# Create map data with AK, HI inset.
# Inspired by http://stackoverflow.com/a/13767984
if (require(rgeos) & require(maptools) & require(rgdal) & require(dplyr)) {
  transform_state <- function(object, rot, scale, shift){
    object %>% elide(rotate = rot) %>%
      elide(scale = max(apply(bbox(object), 1, diff)) / scale) %>%
      elide(shift = shift)
  }
  # State shape file from
  # http://www.arcgis.com/home/item.html?id=f7f805eb65eb4ab787a0a3e1116ca7e5
  loc <- file.path(tempdir(), "stats_dat")
  unzip(system.file("extdata", "states_21basic.zip", 
                    package = "fiftystater"), exdir = loc)
  fifty_states_sp <- readOGR(dsn = loc, layer = "states") %>%
    spTransform(CRS("+init=epsg:2163"))
  
  alaska <- fifty_states_sp[fifty_states_sp$STATE_NAME == "Alaska", ] %>%
    transform_state(-35, 1.5, c(-2800000, -2600000))
  proj4string(alaska) <- proj4string(fifty_states_sp)
  
  hawaii <- fifty_states_sp[fifty_states_sp$STATE_NAME == "Hawaii", ] %>%
    transform_state(-35, .75, c(-1000000,-2400000))
  proj4string(hawaii) <- proj4string(fifty_states_sp)
  
  fifty_states <-
    fifty_states_sp[!fifty_states_sp$STATE_NAME %in% c("Alaska","Hawaii"), ] %>%
    rbind(alaska) %>%
    rbind(hawaii) %>%
    spTransform(CRS("+init=epsg:4326")) %>%
    fortify(region = "STATE_NAME") %>%
    mutate(id = tolower(id))
}
```
